"use strict";(self.webpackChunkkolosu=self.webpackChunkkolosu||[]).push([[5930],{5930:(F,v,n)=>{n.r(v),n.d(v,{DispositivoComponentModule:()=>B});var f=n(6895),p=n(7046),m=n(5861),d=n(805);let u=(()=>{class a{constructor(){this.id_vehiculo=0,this.placa="",this.marca="",this.modelo="",this.color="",this.cilindrada="",this.id_cliente=0,this.activar_motor="",this.desactivar_motor="",this.motor="",this.id_geocercas=[],this.geocercas="",this.id_notificaciones=[],this.notificaciones="",this.device_id=0,this.command="",this.id_dispositivo=0}static initialize(e){this.ComboGeocerca(e),this.ComboNotificaciones(e)}static ComboGeocerca(e){e.getAll("servicio/lista_geocercas").subscribe({next:o=>{const i=(o.lista_geocercas||[]).map(l=>({label:l.nombre_geocerca,value:l.id})),r=a.columns_geocerca.find(l=>"id_geocercas"===l.field);r&&(r.options=i)},error:o=>{console.error("Error cargando opciones de geocerca",o)}})}static ComboNotificaciones(e){e.getAll("servicio/lista_geocercas").subscribe({next:o=>{const i=(o.lista_notificacion||[]).map(l=>({label:l.notificacion,value:l.id_notificacion})),r=a.columns_geocerca.find(l=>"id_notificaciones"===l.field);r&&(r.options=i)},error:o=>{console.error("Error cargando opciones de geocerca",o)}})}}return a.columns=[{field:"id_vehiculo",header:"ID",visibleTable:!1,visibleForm:!1,inputType:"number",required:!1,primaryKey:!0},{field:"placa",header:"Placa",visibleTable:!0,visibleForm:!1,inputType:"text",required:!0},{field:"marca",header:"Marca",visibleTable:!0,visibleForm:!1,inputType:"text",required:!0},{field:"modelo",header:"Modelo",visibleTable:!0,visibleForm:!1,inputType:"text",required:!0},{field:"color",header:"Color",visibleTable:!0,visibleForm:!1,inputType:"text",required:!0},{field:"cilindrada",header:"Cilindrada",visibleTable:!0,visibleForm:!1,inputType:"text",required:!0},{field:"geocercas",header:"Geocercas",visibleTable:!0,visibleForm:!1,inputType:"text",required:!1},{field:"notificaciones",header:"Notificaciones",visibleTable:!0,visibleForm:!1,inputType:"text",required:!1},{field:"id_cliente",header:"Persona",visibleTable:!1,visibleForm:!1,inputType:"select",required:!1,options:[],multiple:!1},{field:"motor",header:"Motor",visibleTable:!0,visibleForm:!1,inputType:"text",required:!1}],a.columns_geocerca=[{field:"id_vehiculo",header:"ID",visibleTable:!1,visibleForm:!1,inputType:"number",required:!1,primaryKey:!0},{field:"id_geocercas",header:"geocercas",placeholder:"Seleccionar",visibleTable:!0,visibleForm:!0,inputType:"select",required:!0,options:[],multiple:!0},{field:"id_notificaciones",header:"Notificaciones",placeholder:"Seleccionar",visibleTable:!0,visibleForm:!0,inputType:"select",required:!0,options:[],multiple:!0}],a})();var s=n(1571),h=n(6253),b=n(8631),g=n(3617),_=n(2453),C=n(2137),D=n(1023),T=n(4594);const y=function(){return{width:"50vw"}},S=[{path:"",component:(()=>{class a{constructor(e,o,t,i,r){this.apiService=e,this.messageService=o,this.router=t,this.traccar=i,this.confirmationService=r,this.loading=!1,this.lista_dispositivo=[],this.columnas_dispositivo=u.columns,this.columns_geocerca=u.columns_geocerca,this.toolbarButtons=new Array,this.modal_geocerca=!1,this.selectedGeocerca={}}ngOnInit(){var e=this;return(0,m.Z)(function*(){e.token=yield e.getToken(),e.token?e.traccar.post_iniciar_sesion(e.token).subscribe({next:()=>{e.ListarDispositivo(),u.initialize(e.apiService),e.AgregarBotones()},error:o=>{e.isConnectionError(o)?console.log("ERROR AL INICIAR SESI\xd3N: No hay conexi\xf3n a Internet"):(localStorage.removeItem("accesos"),e.router.navigate(["/auth/login"])),e.loading=!1}}):(e.loading=!1,localStorage.removeItem("accesos"),e.router.navigate(["/auth/login"]))})()}isConnectionError(e){return!navigator.onLine||0===e.status}getToken(){return(0,m.Z)(function*(){return JSON.parse(localStorage.getItem("accesos")||"{}").token_socket||""})()}cerrarModalFiltro(){this.modal_geocerca=!1}aplicarFiltro(e){console.log("Parmetros recibidos",e),this.loading=!0,this.modal_geocerca=!1,this.apiService.create("servicio/post_geocercas_dispositivo",e).subscribe({next:o=>{var t;const i=null===(t=o?.mensaje)||void 0===t?void 0:t[0];i?this.MensajeError(i):this.ListarDispositivo()},error:o=>{this.MensajeError("Verifique su conexion a internet")},complete:()=>{this.modal_geocerca=!1}})}ListarDispositivo(){this.loading=!0,this.apiService.getAll("vehiculo/lista_dispositivos").subscribe({next:e=>{this.lista_dispositivo=e.lista_dispositivos},error:e=>{this.MensajeError("Error al obtener la lista")},complete:()=>{this.loading=!1}})}guardarDispositivo(e){console.log("hola ",e)}seleccionarDispositivo(e){this.messageService.clear(),this.MensajeInfo(e.placa,!0),this.selectedGeocerca={id_vehiculo:e.id_vehiculo,id_geocercas:JSON.parse(e.id_geocercas),id_notificaciones:JSON.parse(e.id_notificaciones),placa:e.placa},this.ButtonEnabled("btnGeocerca",!1),this.ButtonEnabled("btnBloqueo",!1),this.ButtonEnabled("btnDesbloqueo",!1)}deshacerSeleccionDispositivo(e){this.ButtonEnabled("btnGeocerca",!0),this.ButtonEnabled("btnBloqueo",!0),this.ButtonEnabled("btnDesbloqueo",!0)}AgregarBotones(){this.toolbarButtons.push({name:"btnGeocerca",label:"Geocercas",tooltip:"Asignar Geocerca",action:"onGeocerca",icon:"pi pi-map",disabled:!0,class:"p-button-rounded p-button-info"}),this.toolbarButtons.push({name:"btnBloqueo",label:"Desactivar motor",tooltip:"Desactivar motor",action:"onBloqueo",icon:"pi pi-lock",disabled:!0,class:"p-button-rounded p-button-danger"}),this.toolbarButtons.push({name:"btnDesbloqueo",label:"Activar motor",tooltip:"Activar motor",action:"onDesbloqueo",icon:"pi pi-lock-open",disabled:!0,class:"p-button-rounded p-button-success"})}ButtonClick(e){const{action:o,rowData:t}=e;let i,r;"onGeocerca"===o?this.modal_geocerca=!0:"onBloqueo"===o?(i=t.desactivar_motor?t.desactivar_motor.trim():"",r=t.id_dispositivo,this.confirmationService.confirm({message:"\xbfEst\xe1s seguro de desactivar el motor?",header:"Dispositivo "+this.selectedGeocerca.placa,icon:"pi pi-exclamation-triangle",acceptLabel:"S\xed",rejectLabel:"No",accept:()=>{this.enviarComando(i,r)},reject:()=>{}})):"onDesbloqueo"===o?(i=t.activar_motor?t.activar_motor.trim():"",r=t.id_dispositivo,this.confirmationService.confirm({message:"\xbfEst\xe1s seguro de activar el motor?",header:"Dispositivo "+this.selectedGeocerca.placa,icon:"pi pi-exclamation-triangle",acceptLabel:"S\xed",rejectLabel:"No",accept:()=>{this.enviarComando(i,r)},reject:()=>{}})):console.error("Acci\xf3n no soportada")}enviarComando(e,o){var t=this;if(""==e?.trim())return void this.MensajeError("El dispositivo no est\xe1 configurado para la operaci\xf3n.");const i=o,r=e;var l;this.loading=!0,this.traccar.enviarComandoPersonalizado(i,r).subscribe({next:(l=(0,m.Z)(function*(j){yield t.sleep(1e4),t.historialComando(i,e)}),function(G){return l.apply(this,arguments)}),error:l=>{this.MensajeError("Error al enviar el comando"),this.loading=!1},complete:()=>{}})}historialComando(e,o){let t=new u;t.device_id=e,t.command=o,this.loading=!0,this.apiService.create("vehiculo/post_enviarComando",t).subscribe({next:i=>{var r;const l=null===(r=i?.mensaje)||void 0===r?void 0:r[0];l?this.MensajeError(l):(this.ListarDispositivo(),this.MensajeSucces("Comando enviado"))},error:i=>{this.MensajeError("Verifique su conexi\xf3n a internet"),console.log(i)},complete:()=>{this.loading=!1}})}sleep(e){return new Promise(o=>setTimeout(o,e))}MensajeError(e){this.messageService.add({severity:"error",summary:"Error",detail:e})}MensajeSucces(e){this.messageService.add({severity:"success",summary:"Exito",detail:e})}MensajeInfo(e,o){this.messageService.add(1==o?{severity:"info",summary:"Seleccionado",detail:e}:{severity:"info",summary:"Informaci\ufffdn",detail:e})}ButtonEnabled(e,o){this.toolbarButtons.forEach(t=>{t.name===e&&(t.disabled=o)})}}return a.\u0275fac=function(e){return new(e||a)(s.Y36(h.s),s.Y36(d.ez),s.Y36(p.F0),s.Y36(b.u),s.Y36(d.YP))},a.\u0275cmp=s.Xpm({type:a,selectors:[["app-dispositivo"]],features:[s._Bn([d.ez,d.YP])],decls:6,vars:14,consts:[[1,"card"],[3,"loading"],["titleTable","Lista de Dispositivo",3,"buttons","columns","data","buttonNew","buttonEdit","buttonDelete","selected","buttonClick","Unselect","formSave"],[3,"titleModal","columns","modalVisible","formData","formSave","closeModal"]],template:function(e,o){1&e&&(s.TgZ(0,"div",0),s._UZ(1,"p-toast")(2,"p-confirmDialog")(3,"app-loading",1),s.TgZ(4,"app-tabla-dinamica",2),s.NdJ("selected",function(i){return o.seleccionarDispositivo(i)})("buttonClick",function(i){return o.ButtonClick(i)})("Unselect",function(i){return o.deshacerSeleccionDispositivo(i)})("formSave",function(i){return o.guardarDispositivo(i)}),s.qZA(),s.TgZ(5,"app-modal-dinamica",3),s.NdJ("formSave",function(i){return o.aplicarFiltro(i)})("closeModal",function(){return o.cerrarModalFiltro()}),s.qZA()()),2&e&&(s.xp6(2),s.Akn(s.DdM(13,y)),s.xp6(1),s.Q6J("loading",o.loading),s.xp6(1),s.Q6J("buttons",o.toolbarButtons)("columns",o.columnas_dispositivo)("data",o.lista_dispositivo)("buttonNew",!1)("buttonEdit",!1)("buttonDelete",!1),s.xp6(1),s.MGl("titleModal","Asignar Geocerca ",o.selectedGeocerca.placa,""),s.Q6J("columns",o.columns_geocerca)("modalVisible",o.modal_geocerca)("formData",o.selectedGeocerca))},dependencies:[g.N,_.FN,C.Q,D.C,T.b],styles:["[_nghost-%COMP%]     .p-confirm-dialog{max-width:600px;margin:auto}@media (max-width: 768px){[_nghost-%COMP%]     .p-confirm-dialog{max-width:90vw;width:100%}[_nghost-%COMP%]     .p-confirm-dialog .p-dialog-footer{display:flex;justify-content:space-between;flex-wrap:wrap}[_nghost-%COMP%]     .p-confirm-dialog .p-button{flex:1 1 45%;margin:.5em}}"]}),a})()}];let M=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=s.oAB({type:a}),a.\u0275inj=s.cJS({imports:[p.Bz.forChild(S),p.Bz]}),a})();var E=n(1511);let B=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=s.oAB({type:a}),a.\u0275inj=s.cJS({imports:[f.ez,M,E.m]}),a})()}}]);