(self.webpackChunkkolosu=self.webpackChunkkolosu||[]).push([[1068],{3617:(D,E,k)=>{"use strict";k.d(E,{N:()=>r});var w=k(1571),t=k(1493),e=k(7932);const i=function(){return{width:"80px",height:"80px"}};let r=(()=>{class u{constructor(){this.loading=!1,this.loadingText="Cargando."}}return u.\u0275fac=function(g){return new(g||u)},u.\u0275cmp=w.Xpm({type:u,selectors:[["app-loading"]],inputs:{loading:"loading",loadingText:"loadingText"},decls:3,vars:11,consts:[["header","Cargando","styleClass","loading-dialog","showEffect","fade","hideEffect","fade","role","alertdialog","aria-live","assertive",3,"visible","modal","closeOnEscape","draggable","resizable","closable","blockScroll","baseZIndex","visibleChange"],[1,"flex","flex-column","align-items-center"],["strokeWidth","10","animationDuration",".5s","aria-label","Cargando"]],template:function(g,f){1&g&&(w.TgZ(0,"p-dialog",0),w.NdJ("visibleChange",function(C){return f.loading=C}),w.TgZ(1,"div",1),w._UZ(2,"p-progressSpinner",2),w.qZA()()),2&g&&(w.Q6J("visible",f.loading)("modal",!0)("closeOnEscape",!1)("draggable",!1)("resizable",!1)("closable",!1)("blockScroll",!0)("baseZIndex",1e4),w.xp6(2),w.Akn(w.DdM(10,i)))},dependencies:[t.V,e.G],styles:['@charset "UTF-8";[_nghost-%COMP%]     .loading-dialog{max-width:90vw;width:300px;text-align:center;border-radius:10px;display:flex;flex-direction:column;justify-content:center;align-items:center;background:white}[_nghost-%COMP%]     .loading-dialog .p-dialog-header{display:flex;justify-content:center;align-items:center;font-weight:700;font-size:1.2rem;height:50px;background:transparent}@media (max-width: 600px){[_nghost-%COMP%]     .loading-dialog{width:80%}}']}),u})()},7752:(D,E,k)=>{"use strict";k.d(E,{G:()=>bt});var w=k(1571),t=k(8407);function i(p,o){return t.Util.extend(o,p.geocodingQueryParams)}function r(p,o){return t.Util.extend(o,p.reverseQueryParams)}k(7690);let u=0;const _=/[&<>"'`]/g,g=/[&<>"'`]/,f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function y(p){return f[p]}function R(p,o,l,s,a){const n="_l_geocoder_"+u++;o[a||"callback"]=n,window[n]=t.Util.bind(l,s);const h=document.createElement("script");h.type="text/javascript",h.src=p+G(o),h.id=n,document.getElementsByTagName("head")[0].appendChild(h)}function b(p,o,l){const s=new XMLHttpRequest;s.onreadystatechange=function(){if(4!==s.readyState)return;let a;if(200!==s.status&&304!==s.status)a="";else if("string"==typeof s.response)try{a=JSON.parse(s.response)}catch{a=s.response}else a=s.response;l(a)},s.open("GET",p+G(o),!0),s.responseType="json",s.setRequestHeader("Accept","application/json"),s.send(null)}function G(p,o,l){const s=[];for(const a in p){const n=encodeURIComponent(l?a.toUpperCase():a),h=p[a];if(Array.isArray(h))for(let d=0;d<h.length;d++)s.push(n+"="+encodeURIComponent(h[d]));else s.push(n+"="+encodeURIComponent(String(h)))}return(o&&-1!==o.indexOf("?")?"&":"?")+s.join("&")}class H{constructor(o){this.options={serviceUrl:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",apiKey:""},t.Util.setOptions(this,o)}geocode(o,l,s){const a=i(this.options,{token:this.options.apiKey,SingleLine:o,outFields:"Addr_Type",forStorage:!1,maxLocations:10,f:"json"});b(this.options.serviceUrl+"/findAddressCandidates",a,n=>{const h=[];if(n.candidates&&n.candidates.length)for(let d=0;d<=n.candidates.length-1;d++){const c=n.candidates[d],m=t.latLng(c.location.y,c.location.x),v=t.latLngBounds(t.latLng(c.extent.ymax,c.extent.xmax),t.latLng(c.extent.ymin,c.extent.xmin));h[d]={name:c.address,bbox:v,center:m}}l.call(s,h)})}suggest(o,l,s){return this.geocode(o,l,s)}reverse(o,l,s,a){const n=r(this.options,{location:o.lng+","+o.lat,distance:100,f:"json"});b(this.options.serviceUrl+"/reverseGeocode",n,h=>{const d=[];if(h&&!h.error){const c=t.latLng(h.location.y,h.location.x),m=t.latLngBounds(c,c);d.push({name:h.address.Match_addr,center:c,bbox:m})}s.call(a,d)})}}class z{constructor(o){this.options={serviceUrl:"https://dev.virtualearth.net/REST/v1/Locations"},t.Util.setOptions(this,o)}geocode(o,l,s){const a=i(this.options,{query:o,key:this.options.apiKey});R(this.options.apiKey,a,n=>{const h=[];if(n.resourceSets.length>0)for(let d=n.resourceSets[0].resources.length-1;d>=0;d--){const c=n.resourceSets[0].resources[d],m=c.bbox;h[d]={name:c.name,bbox:t.latLngBounds([m[0],m[1]],[m[2],m[3]]),center:t.latLng(c.point.coordinates)}}l.call(s,h)},this,"jsonp")}reverse(o,l,s,a){const n=r(this.options,{key:this.options.apiKey});R(this.options.serviceUrl+o.lat+","+o.lng,n,h=>{const d=[];for(let c=h.resourceSets[0].resources.length-1;c>=0;c--){const m=h.resourceSets[0].resources[c],v=m.bbox;d[c]={name:m.name,bbox:t.latLngBounds([v[0],v[1]],[v[2],v[3]]),center:t.latLng(m.point.coordinates)}}s.call(a,d)},this,"jsonp")}}class N{constructor(o){this.options={serviceUrl:"https://maps.googleapis.com/maps/api/geocode/json"},t.Util.setOptions(this,o)}geocode(o,l,s){const a=i(this.options,{key:this.options.apiKey,address:o});b(this.options.serviceUrl,a,n=>{const h=[];if(n.results&&n.results.length)for(let d=0;d<=n.results.length-1;d++){const c=n.results[d],m=t.latLng(c.geometry.location),v=t.latLngBounds(t.latLng(c.geometry.viewport.northeast),t.latLng(c.geometry.viewport.southwest));h[d]={name:c.formatted_address,bbox:v,center:m,properties:c.address_components}}l.call(s,h)})}reverse(o,l,s,a){const n=r(this.options,{key:this.options.apiKey,latlng:o.lat+","+o.lng});b(this.options.serviceUrl,n,h=>{const d=[];if(h.results&&h.results.length)for(let c=0;c<=h.results.length-1;c++){const m=h.results[c],v=t.latLng(m.geometry.location),M=t.latLngBounds(t.latLng(m.geometry.viewport.northeast),t.latLng(m.geometry.viewport.southwest));d[c]={name:m.formatted_address,bbox:M,center:v,properties:m.address_components}}s.call(a,d)})}}class A{constructor(o){if(this.options={serviceUrl:"https://geocoder.api.here.com/6.2/",app_id:"",app_code:"",apiKey:"",maxResults:5},t.Util.setOptions(this,o),o.apiKey)throw Error("apiKey is not supported, use app_id/app_code instead!")}geocode(o,l,s){const a=i(this.options,{searchtext:o,gen:9,app_id:this.options.app_id,app_code:this.options.app_code,jsonattributes:1,maxresults:this.options.maxResults});this.getJSON(this.options.serviceUrl+"geocode.json",a,l,s)}reverse(o,l,s,a){let n=o.lat+","+o.lng;this.options.reverseGeocodeProxRadius&&(n+=","+this.options.reverseGeocodeProxRadius);const h=r(this.options,{prox:n,mode:"retrieveAddresses",app_id:this.options.app_id,app_code:this.options.app_code,gen:9,jsonattributes:1,maxresults:this.options.maxResults});this.getJSON(this.options.serviceUrl+"reversegeocode.json",h,s,a)}getJSON(o,l,s,a){b(o,l,n=>{const h=[];if(n.response.view&&n.response.view.length)for(let d=0;d<=n.response.view[0].result.length-1;d++){const c=n.response.view[0].result[d].location,m=t.latLng(c.displayPosition.latitude,c.displayPosition.longitude),v=t.latLngBounds(t.latLng(c.mapView.topLeft.latitude,c.mapView.topLeft.longitude),t.latLng(c.mapView.bottomRight.latitude,c.mapView.bottomRight.longitude));h[d]={name:c.address.label,properties:c.address,bbox:v,center:m}}s.call(a,h)})}}class B{constructor(o){this.options={serviceUrl:"https://geocode.search.hereapi.com/v1",apiKey:"",app_id:"",app_code:"",maxResults:10},t.Util.setOptions(this,o)}geocode(o,l,s){const a=i(this.options,{q:o,apiKey:this.options.apiKey,limit:this.options.maxResults});if(!a.at&&!a.in)throw Error("at / in parameters not found. Please define coordinates (at=latitude,longitude) or other (in) in your geocodingQueryParams.");this.getJSON(this.options.serviceUrl+"/discover",a,l,s)}reverse(o,l,s,a){const n=r(this.options,{at:o.lat+","+o.lng,limit:this.options.reverseGeocodeProxRadius,apiKey:this.options.apiKey});this.getJSON(this.options.serviceUrl+"/revgeocode",n,s,a)}getJSON(o,l,s,a){b(o,l,n=>{const h=[];if(n.items&&n.items.length)for(let d=0;d<=n.items.length-1;d++){const c=n.items[d],m=t.latLng(c.position.lat,c.position.lng);let v;v=c.mapView?t.latLngBounds(t.latLng(c.mapView.south,c.mapView.west),t.latLng(c.mapView.north,c.mapView.east)):t.latLngBounds(t.latLng(c.position.lat,c.position.lng),t.latLng(c.position.lat,c.position.lng)),h[d]={name:c.address.label,properties:c.address,bbox:v,center:m}}s.call(a,h)})}}function F(p){let o;return(o=p.match(/^([NS])\s*(\d{1,3}(?:\.\d*)?)\W*([EW])\s*(\d{1,3}(?:\.\d*)?)$/))?t.latLng((/N/i.test(o[1])?1:-1)*+o[2],(/E/i.test(o[3])?1:-1)*+o[4]):(o=p.match(/^(\d{1,3}(?:\.\d*)?)\s*([NS])\W*(\d{1,3}(?:\.\d*)?)\s*([EW])$/))?t.latLng((/N/i.test(o[2])?1:-1)*+o[1],(/E/i.test(o[4])?1:-1)*+o[3]):(o=p.match(/^([NS])\s*(\d{1,3})\xb0?\s*(\d{1,3}(?:\.\d*)?)?['\u2032]?\W*([EW])\s*(\d{1,3})\xb0?\s*(\d{1,3}(?:\.\d*)?)?['\u2032]?$/))?t.latLng((/N/i.test(o[1])?1:-1)*(+o[2]+ +o[3]/60),(/E/i.test(o[4])?1:-1)*(+o[5]+ +o[6]/60)):(o=p.match(/^(\d{1,3})\xb0?\s*(\d{1,3}(?:\.\d*)?)?['\u2032]?\s*([NS])\W*(\d{1,3})\xb0?\s*(\d{1,3}(?:\.\d*)?)?['\u2032]?\s*([EW])$/))?t.latLng((/N/i.test(o[3])?1:-1)*(+o[1]+ +o[2]/60),(/E/i.test(o[6])?1:-1)*(+o[4]+ +o[5]/60)):(o=p.match(/^([NS])\s*(\d{1,3})\xb0?\s*(\d{1,2})['\u2032]?\s*(\d{1,3}(?:\.\d*)?)?["\u2033]?\W*([EW])\s*(\d{1,3})\xb0?\s*(\d{1,2})['\u2032]?\s*(\d{1,3}(?:\.\d*)?)?["\u2033]?$/))?t.latLng((/N/i.test(o[1])?1:-1)*(+o[2]+ +o[3]/60+ +o[4]/3600),(/E/i.test(o[5])?1:-1)*(+o[6]+ +o[7]/60+ +o[8]/3600)):(o=p.match(/^(\d{1,3})\xb0?\s*(\d{1,2})['\u2032]?\s*(\d{1,3}(?:\.\d*)?)?["\u2033]\s*([NS])\W*(\d{1,3})\xb0?\s*(\d{1,2})['\u2032]?\s*(\d{1,3}(?:\.\d*)?)?["\u2033]?\s*([EW])$/))?t.latLng((/N/i.test(o[4])?1:-1)*(+o[1]+ +o[2]/60+ +o[3]/3600),(/E/i.test(o[8])?1:-1)*(+o[5]+ +o[6]/60+ +o[7]/3600)):(o=p.match(/^\s*([+-]?\d+(?:\.\d*)?)\s*[\s,]\s*([+-]?\d+(?:\.\d*)?)\s*$/))?t.latLng(+o[1],+o[2]):void 0}class V{constructor(o){this.options={next:void 0,sizeInMeters:1e4},t.Util.setOptions(this,o)}geocode(o,l,s){const a=F(o);if(a){const n=[{name:o,center:a,bbox:a.toBounds(this.options.sizeInMeters)}];l.call(s,n)}else this.options.next&&this.options.next.geocode(o,l,s)}}class j{constructor(o){this.options={serviceUrl:"https://api.mapbox.com/geocoding/v5/mapbox.places/"},t.Util.setOptions(this,o)}_getProperties(o){const l={text:o.text,address:o.address};for(let s=0;s<(o.context||[]).length;s++)l[o.context[s].id.split(".")[0]]=o.context[s].text,o.context[s].short_code&&(l.countryShortCode=o.context[s].short_code);return l}geocode(o,l,s){const a=i(this.options,{access_token:this.options.apiKey});void 0!==a.proximity&&void 0!==a.proximity.lat&&void 0!==a.proximity.lng&&(a.proximity=a.proximity.lng+","+a.proximity.lat),b(this.options.serviceUrl+encodeURIComponent(o)+".json",a,n=>{const h=[];if(n.features&&n.features.length)for(let d=0;d<=n.features.length-1;d++){const c=n.features[d],m=t.latLng(c.center.reverse());let v;v=c.bbox?t.latLngBounds(t.latLng(c.bbox.slice(0,2).reverse()),t.latLng(c.bbox.slice(2,4).reverse())):t.latLngBounds(m,m),h[d]={name:c.place_name,bbox:v,center:m,properties:this._getProperties(c)}}l.call(s,h)})}suggest(o,l,s){return this.geocode(o,l,s)}reverse(o,l,s,a){b(this.options.serviceUrl+o.lng+","+o.lat+".json",r(this.options,{access_token:this.options.apiKey}),d=>{const c=[];if(d.features&&d.features.length)for(let m=0;m<=d.features.length-1;m++){const v=d.features[m],M=t.latLng(v.center.reverse());let I;I=v.bbox?t.latLngBounds(t.latLng(v.bbox.slice(0,2).reverse()),t.latLng(v.bbox.slice(2,4).reverse())):t.latLngBounds(M,M),c[m]={name:v.place_name,bbox:I,center:M,properties:this._getProperties(v)}}s.call(a,c)})}}class K{constructor(o){this.options={serviceUrl:"https://www.mapquestapi.com/geocoding/v1"},t.Util.setOptions(this,o),this.options.apiKey=decodeURIComponent(this.options.apiKey)}_formatName(...o){return o.filter(l=>!!l).join(", ")}geocode(o,l,s){const a=i(this.options,{key:this.options.apiKey,location:o,limit:5,outFormat:"json"});b(this.options.serviceUrl+"/address",a,t.Util.bind(function(n){const h=[];if(n.results&&n.results[0].locations)for(let d=n.results[0].locations.length-1;d>=0;d--){const c=n.results[0].locations[d],m=t.latLng(c.latLng);h[d]={name:this._formatName(c.street,c.adminArea4,c.adminArea3,c.adminArea1),bbox:t.latLngBounds(m,m),center:m}}l.call(s,h)},this))}reverse(o,l,s,a){const n=r(this.options,{key:this.options.apiKey,location:o.lat+","+o.lng,outputFormat:"json"});b(this.options.serviceUrl+"/reverse",n,t.Util.bind(function(h){const d=[];if(h.results&&h.results[0].locations)for(let c=h.results[0].locations.length-1;c>=0;c--){const m=h.results[0].locations[c],v=t.latLng(m.latLng);d[c]={name:this._formatName(m.street,m.adminArea4,m.adminArea3,m.adminArea1),bbox:t.latLngBounds(v,v),center:v}}s.call(a,d)},this))}}class Y{constructor(o){this.options={userId:void 0,apiKey:void 0,serviceUrl:"https://neutrinoapi.com/"},t.Util.setOptions(this,o)}geocode(o,l,s){const a=i(this.options,{apiKey:this.options.apiKey,userId:this.options.userId,address:o.split(/\s+/).join(".")});b(this.options.serviceUrl+"geocode-address",a,n=>{const h=[];if(n.locations){n.geometry=n.locations[0];const d=t.latLng(n.geometry.latitude,n.geometry.longitude),c=t.latLngBounds(d,d);h[0]={name:n.geometry.address,bbox:c,center:d}}l.call(s,h)})}suggest(o,l,s){return this.geocode(o,l,s)}reverse(o,l,s,a){const n=r(this.options,{apiKey:this.options.apiKey,userId:this.options.userId,latitude:o.lat,longitude:o.lng});b(this.options.serviceUrl+"geocode-reverse",n,h=>{const d=[];if(200==h.status.status&&h.found){const c=t.latLng(o.lat,o.lng),m=t.latLngBounds(c,c);d[0]={name:h.address,bbox:m,center:c}}s.call(a,d)})}}class T{constructor(o){this.options={serviceUrl:"https://nominatim.openstreetmap.org/",htmlTemplate:function(l){const s=l.address;let a;const n=[];return(s.road||s.building)&&n.push("{building} {road} {house_number}"),(s.city||s.town||s.village||s.hamlet)&&(a=n.length>0?"leaflet-control-geocoder-address-detail":"",n.push('<span class="'+a+'">{postcode} {city} {town} {village} {hamlet}</span>')),(s.state||s.country)&&(a=n.length>0?"leaflet-control-geocoder-address-context":"",n.push('<span class="'+a+'">{state} {country}</span>')),function q(p,o){return p.replace(/\{ *([\w_]+) *\}/g,(l,s)=>{let a=o[s];return void 0===a?a="":"function"==typeof a&&(a=a(o)),function C(p){return null==p?"":p?g.test(p=""+p)?p.replace(_,y):p:p+""}(a)})}(n.join("<br/>"),s)}},t.Util.setOptions(this,o||{})}geocode(o,l,s){const a=i(this.options,{q:o,limit:5,format:"json",addressdetails:1});b(this.options.serviceUrl+"search",a,n=>{const h=[];for(let d=n.length-1;d>=0;d--){const c=n[d].boundingbox;for(let m=0;m<4;m++)c[m]=+c[m];h[d]={icon:n[d].icon,name:n[d].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(n[d]):void 0,bbox:t.latLngBounds([c[0],c[2]],[c[1],c[3]]),center:t.latLng(n[d].lat,n[d].lon),properties:n[d]}}l.call(s,h)})}reverse(o,l,s,a){const n=r(this.options,{lat:o.lat,lon:o.lng,zoom:Math.round(Math.log(l/256)/Math.log(2)),addressdetails:1,format:"json"});b(this.options.serviceUrl+"reverse",n,h=>{const d=[];if(h&&h.lat&&h.lon){const c=t.latLng(h.lat,h.lon),m=t.latLngBounds(c,c);d.push({name:h.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(h):void 0,center:c,bbox:m,properties:h})}s.call(a,d)})}}class W{constructor(o){t.Util.setOptions(this,o)}geocode(o,l,s){try{const a=this.options.OpenLocationCode.decode(o),n={name:o,center:t.latLng(a.latitudeCenter,a.longitudeCenter),bbox:t.latLngBounds(t.latLng(a.latitudeLo,a.longitudeLo),t.latLng(a.latitudeHi,a.longitudeHi))};l.call(s,[n])}catch(a){console.warn(a),l.call(s,[])}}reverse(o,l,s,a){try{const h={name:this.options.OpenLocationCode.encode(o.lat,o.lng,this.options.codeLength),center:t.latLng(o.lat,o.lng),bbox:t.latLngBounds(t.latLng(o.lat,o.lng),t.latLng(o.lat,o.lng))};s.call(a,[h])}catch(n){console.warn(n),s.call(a,[])}}}class X{constructor(o){this.options={serviceUrl:"https://api.opencagedata.com/geocode/v1/json"},t.Util.setOptions(this,o)}geocode(o,l,s){const a=i(this.options,{key:this.options.apiKey,q:o});b(this.options.serviceUrl,a,n=>{const h=[];if(n.results&&n.results.length)for(let d=0;d<n.results.length;d++){const c=n.results[d],m=t.latLng(c.geometry);let v;v=c.annotations&&c.annotations.bounds?t.latLngBounds(t.latLng(c.annotations.bounds.northeast),t.latLng(c.annotations.bounds.southwest)):t.latLngBounds(m,m),h.push({name:c.formatted,bbox:v,center:m})}l.call(s,h)})}suggest(o,l,s){return this.geocode(o,l,s)}reverse(o,l,s,a){const n=r(this.options,{key:this.options.apiKey,q:[o.lat,o.lng].join(",")});b(this.options.serviceUrl,n,h=>{const d=[];if(h.results&&h.results.length)for(let c=0;c<h.results.length;c++){const m=h.results[c],v=t.latLng(m.geometry);let M;M=m.annotations&&m.annotations.bounds?t.latLngBounds(t.latLng(m.annotations.bounds.northeast),t.latLng(m.annotations.bounds.southwest)):t.latLngBounds(v,v),d.push({name:m.formatted,bbox:M,center:v})}s.call(a,d)})}}class x{constructor(o){this.options={serviceUrl:"https://api.geocode.earth/v1"},this._lastSuggest=0,t.Util.setOptions(this,o)}geocode(o,l,s){const a=i(this.options,{api_key:this.options.apiKey,text:o});b(this.options.serviceUrl+"/search",a,n=>{l.call(s,this._parseResults(n,"bbox"))})}suggest(o,l,s){const a=i(this.options,{api_key:this.options.apiKey,text:o});b(this.options.serviceUrl+"/autocomplete",a,n=>{n.geocoding.timestamp>this._lastSuggest&&(this._lastSuggest=n.geocoding.timestamp,l.call(s,this._parseResults(n,"bbox")))})}reverse(o,l,s,a){const n=r(this.options,{api_key:this.options.apiKey,"point.lat":o.lat,"point.lon":o.lng});b(this.options.serviceUrl+"/reverse",n,h=>{s.call(a,this._parseResults(h,"bounds"))})}_parseResults(o,l){const s=[];return t.geoJSON(o,{pointToLayer:function(a,n){return t.circleMarker(n)},onEachFeature:function(a,n){const h={};let d,c;n.getBounds?(d=n.getBounds(),c=d.getCenter()):n.feature.bbox?(c=n.getLatLng(),d=t.latLngBounds(t.GeoJSON.coordsToLatLng(n.feature.bbox.slice(0,2)),t.GeoJSON.coordsToLatLng(n.feature.bbox.slice(2,4)))):(c=n.getLatLng(),d=t.latLngBounds(c,c)),h.name=n.feature.properties.label,h.center=c,h[l]=d,h.properties=n.feature.properties,s.push(h)}}),s}}function P(p){return new x(p)}const dt=x,pt=P,ut=x,_t=P;class Z extends x{constructor(o){super(t.Util.extend({serviceUrl:"https://api.openrouteservice.org/geocode"},o))}}class J{constructor(o){this.options={serviceUrl:"https://photon.komoot.io/api/",reverseUrl:"https://photon.komoot.io/reverse/",nameProperties:["name","street","suburb","hamlet","town","city","state","country"]},t.Util.setOptions(this,o)}geocode(o,l,s){const a=i(this.options,{q:o});b(this.options.serviceUrl,a,t.Util.bind(function(n){l.call(s,this._decodeFeatures(n))},this))}suggest(o,l,s){return this.geocode(o,l,s)}reverse(o,l,s,a){const n=r(this.options,{lat:o.lat,lon:o.lng});b(this.options.reverseUrl,n,t.Util.bind(function(h){s.call(a,this._decodeFeatures(h))},this))}_decodeFeatures(o){const l=[];if(o&&o.features)for(let s=0;s<o.features.length;s++){const a=o.features[s],n=a.geometry.coordinates,h=t.latLng(n[1],n[0]),d=a.properties.extent,c=d?t.latLngBounds([d[1],d[0]],[d[3],d[2]]):t.latLngBounds(h,h);l.push({name:this._decodeFeatureName(a),html:this.options.htmlTemplate?this.options.htmlTemplate(a):void 0,center:h,bbox:c,properties:a.properties})}return l}_decodeFeatureName(o){return(this.options.nameProperties||[]).map(l=>o.properties[l]).filter(l=>!!l).join(", ")}}class Q{constructor(o){this.options={serviceUrl:"https://api.what3words.com/v2/"},t.Util.setOptions(this,o)}geocode(o,l,s){b(this.options.serviceUrl+"forward",i(this.options,{key:this.options.apiKey,addr:o.split(/\s+/).join(".")}),a=>{const n=[];if(a.geometry){const h=t.latLng(a.geometry.lat,a.geometry.lng),d=t.latLngBounds(h,h);n[0]={name:a.words,bbox:d,center:h}}l.call(s,n)})}suggest(o,l,s){return this.geocode(o,l,s)}reverse(o,l,s,a){b(this.options.serviceUrl+"reverse",r(this.options,{key:this.options.apiKey,coords:[o.lat,o.lng].join(",")}),n=>{const h=[];if(200==n.status.status){const d=t.latLng(n.geometry.lat,n.geometry.lng),c=t.latLngBounds(d,d);h[0]={name:n.words,bbox:c,center:d}}s.call(a,h)})}}var Lt={__proto__:null,geocodingParams:i,reverseParams:r,ArcGis:H,arcgis:function tt(p){return new H(p)},Bing:z,bing:function et(p){return new z(p)},Google:N,google:function it(p){return new N(p)},HERE:A,HEREv2:B,here:function ot(p){return p.apiKey?new B(p):new A(p)},parseLatLng:F,LatLng:V,latLng:function st(p){return new V(p)},Mapbox:j,mapbox:function nt(p){return new j(p)},MapQuest:K,mapQuest:function rt(p){return new K(p)},Neutrino:Y,neutrino:function at(p){return new Y(p)},Nominatim:T,nominatim:function lt(p){return new T(p)},OpenLocationCode:W,openLocationCode:function ht(p){return new W(p)},OpenCage:X,opencage:function ct(p){return new X(p)},Pelias:x,pelias:P,GeocodeEarth:dt,geocodeEarth:pt,Mapzen:ut,mapzen:_t,Openrouteservice:Z,openrouteservice:function gt(p){return new Z(p)},Photon:J,photon:function mt(p){return new J(p)},What3Words:Q,what3words:function ft(p){return new Q(p)}};class U{constructor(...o){}}t.Util.extend(U.prototype,t.Control.prototype),t.Util.extend(U.prototype,t.Evented.prototype);class S extends U{constructor(o){super(o),this.options={showUniqueResult:!0,showResultIcons:!1,collapsed:!0,expand:"touch",position:"topright",placeholder:"Search...",errorMessage:"Nothing found.",iconLabel:"Initiate a new search",query:"",queryMinLength:1,suggestMinLength:3,suggestTimeout:250,defaultMarkGeocode:!0},this._requestCount=0,t.Util.setOptions(this,o),this.options.geocoder||(this.options.geocoder=new T)}addThrobberClass(){t.DomUtil.addClass(this._container,"leaflet-control-geocoder-throbber")}removeThrobberClass(){t.DomUtil.removeClass(this._container,"leaflet-control-geocoder-throbber")}onAdd(o){const l="leaflet-control-geocoder",s=t.DomUtil.create("div",l+" leaflet-bar"),a=t.DomUtil.create("button",l+"-icon",s),n=this._form=t.DomUtil.create("div",l+"-form",s);this._map=o,this._container=s,a.innerHTML="&nbsp;",a.type="button",a.setAttribute("aria-label",this.options.iconLabel);const h=this._input=t.DomUtil.create("input","",n);return h.type="text",h.value=this.options.query,h.placeholder=this.options.placeholder,t.DomEvent.disableClickPropagation(h),this._errorElement=t.DomUtil.create("div",l+"-form-no-error",s),this._errorElement.innerHTML=this.options.errorMessage,this._alts=t.DomUtil.create("ul",l+"-alternatives leaflet-control-geocoder-alternatives-minimized",s),t.DomEvent.disableClickPropagation(this._alts),t.DomEvent.addListener(h,"keydown",this._keydown,this),this.options.geocoder.suggest&&t.DomEvent.addListener(h,"input",this._change,this),t.DomEvent.addListener(h,"blur",()=>{this.options.collapsed&&!this._preventBlurCollapse&&this._collapse(),this._preventBlurCollapse=!1}),this.options.collapsed?"click"===this.options.expand?t.DomEvent.addListener(s,"click",d=>{0===d.button&&2!==d.detail&&this._toggle()}):"touch"===this.options.expand?t.DomEvent.addListener(s,t.Browser.touch?"touchstart mousedown":"mousedown",d=>{this._toggle(),d.preventDefault(),d.stopPropagation()},this):(t.DomEvent.addListener(s,"mouseover",this._expand,this),t.DomEvent.addListener(s,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(this._expand(),t.DomEvent.addListener(s,t.Browser.touch?"touchstart":"click",()=>this._geocode())),this.options.defaultMarkGeocode&&this.on("markgeocode",this.markGeocode,this),this.on("startgeocode",this.addThrobberClass,this),this.on("finishgeocode",this.removeThrobberClass,this),this.on("startsuggest",this.addThrobberClass,this),this.on("finishsuggest",this.removeThrobberClass,this),t.DomEvent.disableClickPropagation(s),s}setQuery(o){return this._input.value=o,this}_geocodeResult(o,l){if(!l&&this.options.showUniqueResult&&1===o.length)this._geocodeResultSelected(o[0]);else if(o.length>0){this._alts.innerHTML="",this._results=o,t.DomUtil.removeClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),t.DomUtil.addClass(this._container,"leaflet-control-geocoder-options-open");for(let s=0;s<o.length;s++)this._alts.appendChild(this._createAlt(o[s],s))}else t.DomUtil.addClass(this._container,"leaflet-control-geocoder-options-error"),t.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error")}markGeocode(o){const l=o.geocode;return this._map.fitBounds(l.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new t.Marker(l.center).bindPopup(l.html||l.name).addTo(this._map).openPopup(),this}_geocode(o){const l=this._input.value;if(!o&&l.length<this.options.queryMinLength)return;const s=++this._requestCount,a=h=>{s===this._requestCount&&(this.fire(o?"finishsuggest":"finishgeocode",{input:l,results:h}),this._geocodeResult(h,o))};this._lastGeocode=l,o||this._clearResults(),this.fire(o?"startsuggest":"startgeocode",{input:l}),o?this.options.geocoder.suggest(l,a):this.options.geocoder.geocode(l,a)}_geocodeResultSelected(o){this.fire("markgeocode",{geocode:o})}_toggle(){t.DomUtil.hasClass(this._container,"leaflet-control-geocoder-expanded")?this._collapse():this._expand()}_expand(){t.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded"),this._input.select(),this.fire("expand")}_collapse(){t.DomUtil.removeClass(this._container,"leaflet-control-geocoder-expanded"),t.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),t.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),t.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-open"),t.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-error"),this._input.blur(),this.fire("collapse")}_clearResults(){t.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),this._selection=null,t.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),t.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-open"),t.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-error")}_createAlt(o,l){const s=t.DomUtil.create("li",""),a=t.DomUtil.create("a","",s),n=this.options.showResultIcons&&o.icon?t.DomUtil.create("img","",a):null,h=o.html?void 0:document.createTextNode(o.name);return n&&(n.src=o.icon),s.setAttribute("data-result-index",String(l)),o.html?a.innerHTML=a.innerHTML+o.html:h&&a.appendChild(h),t.DomEvent.addListener(s,"mousedown touchstart",c=>{this._preventBlurCollapse=!0,t.DomEvent.stop(c),this._geocodeResultSelected(o),t.DomEvent.on(s,"click touchend",()=>{this.options.collapsed?this._collapse():this._clearResults()})},this),s}_keydown(o){const l=s=>{this._selection&&(t.DomUtil.removeClass(this._selection,"leaflet-control-geocoder-selected"),this._selection=this._selection[s>0?"nextSibling":"previousSibling"]),this._selection||(this._selection=this._alts[s>0?"firstChild":"lastChild"]),this._selection&&t.DomUtil.addClass(this._selection,"leaflet-control-geocoder-selected")};switch(o.keyCode){case 27:this.options.collapsed?this._collapse():this._clearResults();break;case 38:l(-1);break;case 40:l(1);break;case 13:if(this._selection){const s=parseInt(this._selection.getAttribute("data-result-index"),10);this._geocodeResultSelected(this._results[s]),this._clearResults()}else this._geocode();break;default:return}t.DomEvent.preventDefault(o)}_change(){const o=this._input.value;o!==this._lastGeocode&&(clearTimeout(this._suggestTimeout),o.length>=this.options.suggestMinLength?this._suggestTimeout=setTimeout(()=>this._geocode(!0),this.options.suggestTimeout):this._clearResults())}}function $(p){return new S(p)}t.Util.extend(S,Lt),t.Util.extend(t.Control,{Geocoder:S,geocoder:$});var vt=k(529);const O=t.Icon.Default.prototype;O.options.iconUrl="assets/leaflet/images/marker-icon.png",O.options.iconRetinaUrl="assets/leaflet/images/marker-icon-2x.png",O.options.shadowUrl="assets/leaflet/images/marker-shadow.png";let bt=(()=>{class p{constructor(l){this.http=l,this.id_map="",this.geocercaChange=new w.vpe,this.geocercaDeleted=new w.vpe}ngAfterViewInit(){if(this.initMap(this.id_map),this.geocerca){let l;this.drawGeocerca(this.geocerca),this.geocerca.startsWith("POLYGON")?(l={tipo_geocerca:"Pol\xedgono",area:this.geocerca},this.geocercaChange.emit(l)):this.geocerca.startsWith("CIRCLE")&&(l={tipo_geocerca:"Circulo",area:this.geocerca},this.geocercaChange.emit(l))}}drawGeocerca(l){if(l.startsWith("CIRCLE")){const a=/CIRCLE\(([-\d.]+) ([-\d.]+), ([\d.]+)\)/.exec(l);if(a){const n=parseFloat(a[1]),h=parseFloat(a[2]),d=parseFloat(a[3]),c=t.circle([n,h],{radius:d});this.drawnItems.addLayer(c),this.map.fitBounds(c.getBounds())}}else if(l.startsWith("POLYGON")){const a=/POLYGON\(\((.+)\)\)/.exec(l);if(a){const n=a[1].split(",").map(d=>{const[c,m]=d.trim().split(" ").map(Number);return[c,m]}),h=t.polygon(n);this.drawnItems.addLayer(h),this.map.fitBounds(h.getBounds())}}}ngOnDestroy(){this.map&&this.map.remove()}initMap(l){this.map=t.map(l,{attributionControl:!1}).setView([-16.2902,-63.5887],5),t.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xa9 OpenStreetMap contributors"}).addTo(this.map),this.drawnItems=new t.FeatureGroup,this.map.addLayer(this.drawnItems);const s=new t.Control.Draw({draw:{marker:!1,rectangle:!1,circlemarker:!1,polyline:!1},edit:{featureGroup:this.drawnItems,edit:!1,remove:!0}});this.control&&this.map.removeControl(this.control),this.control=$({serviceUrl:"https://ubibol.com/nominatim",placeholder:"Buscar ubicaci\xf3n..."}).addTo(this.map),this.control.on("markgeocode",n=>{console.log("Buscar ubicaci\xf3n:",n.geocode.name),this.customGeocode(n.geocode.name)}),this.map.addControl(s),this.map.on(t.Draw.Event.CREATED,n=>{this.drawnItems.addLayer(n.layer);let d=this.PreparaEnvio(n);this.geocercaChange.emit(d)}),this.map.on(t.Draw.Event.DELETED,n=>{this.geocercaDeleted.emit()})}customGeocode(l){const a=`https://ubibol.com/nominatim/search?q=${encodeURIComponent(l)}&format=json&addressdetails=1&limit=5`;return this.http.get(a).toPromise().then(n=>n?n.map(h=>({name:h.display_name,center:t.latLng(h.lat,h.lon)})):(console.warn("No se encontraron resultados."),[])).catch(n=>(console.error("Error en la b\xfasqueda:",n),[]))}onEnter(l,s){l.preventDefault(),this.customGeocode(s)}PreparaEnvio(l){let s="",a={};if("circle"===l.layerType)s="CIRCLE("+l.layer._latlng.lat+" "+l.layer._latlng.lng+", "+l.layer.options.radius+")",a={tipo_geocerca:"Circulo",area:s};else if("polygon"==l.layerType){let n=l.layer._latlngs[0];s+="POLYGON((";for(let h=0;h<n.length;h++)s+=n[h].lat+" "+n[h].lng,h<n.length-1&&(s+=",");s+="))",a={tipo_geocerca:"Pol\xedgono",area:s}}else a={};return a}}return p.\u0275fac=function(l){return new(l||p)(w.Y36(vt.eN))},p.\u0275cmp=w.Xpm({type:p,selectors:[["app-map"]],inputs:{id_map:"id_map",geocerca:"geocerca"},outputs:{geocercaChange:"geocercaChange",geocercaDeleted:"geocercaDeleted"},decls:1,vars:1,consts:[[1,"map-container",3,"id"]],template:function(l,s){1&l&&w._UZ(0,"div",0),2&l&&w.Q6J("id",s.id_map)},styles:["[class^=map-][_ngcontent-%COMP%]{width:100%;height:400px}"]}),p})()},7690:()=>{var D,E,t;D=window,E=document,L.drawVersion="1.0.4",L.Draw={},L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},finish:{title:"Finish drawing",text:"Finish"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker",circlemarker:"Draw a circlemarker"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},circlemarker:{tooltip:{start:"Click map to place circle marker."}},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}}}},edit:{toolbar:{actions:{save:{title:"Save changes",text:"Save"},cancel:{title:"Cancel editing, discards all changes",text:"Cancel"},clearAll:{title:"Clear all layers",text:"Clear All"}},buttons:{edit:"Edit layers",editDisabled:"No layers to edit",remove:"Delete layers",removeDisabled:"No layers to delete"}},handlers:{edit:{tooltip:{text:"Drag handles or markers to edit features.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove."}}}}},L.Draw.Event={},L.Draw.Event.CREATED="draw:created",L.Draw.Event.EDITED="draw:edited",L.Draw.Event.DELETED="draw:deleted",L.Draw.Event.DRAWSTART="draw:drawstart",L.Draw.Event.DRAWSTOP="draw:drawstop",L.Draw.Event.DRAWVERTEX="draw:drawvertex",L.Draw.Event.EDITSTART="draw:editstart",L.Draw.Event.EDITMOVE="draw:editmove",L.Draw.Event.EDITRESIZE="draw:editresize",L.Draw.Event.EDITVERTEX="draw:editvertex",L.Draw.Event.EDITSTOP="draw:editstop",L.Draw.Event.DELETESTART="draw:deletestart",L.Draw.Event.DELETESTOP="draw:deletestop",L.Draw.Event.TOOLBAROPENED="draw:toolbaropened",L.Draw.Event.TOOLBARCLOSED="draw:toolbarclosed",L.Draw.Event.MARKERCONTEXT="draw:markercontext",L.Draw=L.Draw||{},L.Draw.Feature=L.Handler.extend({initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e);var i=L.version.split(".");1===parseInt(i[0],10)&&parseInt(i[1],10)>=2?L.Draw.Feature.include(L.Evented.prototype):L.Draw.Feature.include(L.Mixin.Events)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DRAWSTOP,{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new L.Draw.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire(L.Draw.Event.CREATED,{layer:t,layerType:this.type})},_cancelDrawing:function(t){27===t.keyCode&&(this._map.fire("draw:canceled",{layerType:this.type}),this.disable())}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,feet:!0,nautic:!1,showLength:!0,zIndexOffset:2e3,factor:1,maxPoints:0},initialize:function(t,e){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,e&&e.drawError&&(e.drawError=L.Util.extend({},this.options.drawError,e.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mouseout",this._onMouseOut,this).on("mousemove",this._onMouseMove,this).on("mousedown",this._onMouseDown,this).on("mouseup",this._onMouseUp,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("touchstart",this._onTouch,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("touchstart",this._onTouch,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=e.getLatLngs(),r=i.splice(-1,1)[0];this._poly.setLatLngs(i),this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(r,!1)}},addVertex:function(t){this._markers.length>=2&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t)?this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(t,!0))},completeShape:function(){this._markers.length<=1||!this._shapeIsValid()||(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_finishShape:function(){var t=this._poly._defaultShape?this._poly._defaultShape():this._poly.getLatLngs(),e=this._poly.newLatLngIntersects(t[t.length-1]);!this.options.allowIntersection&&e||!this._shapeIsValid()?this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_shapeIsValid:function(){return!0},_onZoomEnd:function(){null!==this._markers&&this._updateGuide()},_onMouseMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);this._currentLatLng=i,this._updateTooltip(i),this._updateGuide(e),this._mouseMarker.setLatLng(i),L.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(t,e){this._map.fire(L.Draw.Event.DRAWVERTEX,{layers:this._markerGroup}),this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){if(!this._clickHandled&&!this._touchHandled&&!this._disableMarkers){this._onMouseMove(t),this._clickHandled=!0,this._disableNewMarkers();var e=t.originalEvent;this._startPoint.call(this,e.clientX,e.clientY)}},_startPoint:function(t,e){this._mouseDownOrigin=L.point(t,e)},_onMouseUp:function(t){var e=t.originalEvent;this._endPoint.call(this,e.clientX,e.clientY,t),this._clickHandled=null},_endPoint:function(t,e,i){if(this._mouseDownOrigin){var r=L.point(t,e).distanceTo(this._mouseDownOrigin),u=this._calculateFinishDistance(i.latlng);this.options.maxPoints>1&&this.options.maxPoints==this._markers.length+1?(this.addVertex(i.latlng),this._finishShape()):u<10&&L.Browser.touch?this._finishShape():Math.abs(r)<9*(D.devicePixelRatio||1)&&this.addVertex(i.latlng),this._enableNewMarkers()}this._mouseDownOrigin=null},_onTouch:function(t){var e,i,r=t.originalEvent;!r.touches||!r.touches[0]||this._clickHandled||this._touchHandled||this._disableMarkers||(e=r.touches[0].clientX,i=r.touches[0].clientY,this._disableNewMarkers(),this._touchHandled=!0,this._startPoint.call(this,e,i),this._endPoint.call(this,e,i,t),this._touchHandled=null),this._clickHandled=null},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_calculateFinishDistance:function(t){var e;if(this._markers.length>0){var i;if(this.type===L.Draw.Polyline.TYPE)i=this._markers[this._markers.length-1];else{if(this.type!==L.Draw.Polygon.TYPE)return 1/0;i=this._markers[0]}var r=this._map.latLngToContainerPoint(i.getLatLng()),u=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),_=this._map.latLngToContainerPoint(u.getLatLng());e=r.distanceTo(_)}else e=1/0;return e},_updateFinishHandler:function(){var t=this._markers.length;t>1&&this._markers[t-1].on("click",this._finishShape,this),t>2&&this._markers[t-2].off("click",this._finishShape,this)},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._markers?this._markers.length:0;e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var i,r,u,_=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),f=this.options.maxGuideLineLength,y=_>f?_-f:this.options.guidelineDistance;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));y<_;y+=this.options.guidelineDistance)i=y/_,r={x:Math.floor(t.x*(1-i)+i*e.x),y:Math.floor(t.y*(1-i)+i*e.y)},(u=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer)).style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(u,r)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;e<i;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t,e;return 0===this._markers.length?t={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(e=this.options.showLength?this._getMeasurementString():"",t=1===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:e}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:e}),t},_updateRunningMeasure:function(t,e){var i,r,u=this._markers.length;1===this._markers.length?this._measurementRunningTotal=0:(i=u-(e?2:1),r=L.GeometryUtil.isVersion07x()?t.distanceTo(this._markers[i].getLatLng())*(this.options.factor||1):this._map.distance(t,this._markers[i].getLatLng())*(this.options.factor||1),this._measurementRunningTotal+=r*(e?1:-1))},_getMeasurementString:function(){var t,e=this._currentLatLng,i=this._markers[this._markers.length-1].getLatLng();return t=L.GeometryUtil.isVersion07x()?i&&e&&e.distanceTo?this._measurementRunningTotal+e.distanceTo(i)*(this.options.factor||1):this._measurementRunningTotal||0:i&&e?this._measurementRunningTotal+this._map.distance(e,i)*(this.options.factor||1):this._measurementRunningTotal||0,L.GeometryUtil.readableDistance(t,this.options.metric,this.options.feet,this.options.nautic,this.options.precision)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_disableNewMarkers:function(){this._disableMarkers=!0},_enableNewMarkers:function(){setTimeout(function(){this._disableMarkers=!1}.bind(this),50)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,showLength:!1,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0,feet:!0,nautic:!1,precision:{}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),t>2&&(this._markers[t-1].on("dblclick",this._finishShape,this),t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var t,e;return 0===this._markers.length?t=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?(t=L.drawLocal.draw.handlers.polygon.tooltip.cont,e=this._getMeasurementString()):(t=L.drawLocal.draw.handlers.polygon.tooltip.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area,e="";return t||this.options.showLength?(this.options.showLength&&(e=L.Draw.Polyline.prototype._getMeasurementString.call(this)),t&&(e+="<br>"+L.GeometryUtil.readableArea(t,this.options.metric,this.options.precision)),e):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(t,e){var i;!this.options.allowIntersection&&this.options.showArea&&(i=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(i)),L.Draw.Polyline.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;t>0&&(this._markers[0].off("click",this._finishShape,this),t>2&&this._markers[t-1].off("dblclick",this._finishShape,this))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(t,e){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this).on("touchstart",this._onMouseDown,this).on("touchmove",this._onMouseMove,this),E.addEventListener("touchstart",L.DomEvent.preventDefault,{passive:!1}))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this).off("touchstart",this._onMouseDown,this).off("touchmove",this._onMouseMove,this),L.DomEvent.off(E,"mouseup",this._onMouseUp,this),L.DomEvent.off(E,"touchend",this._onMouseUp,this),E.removeEventListener("touchstart",L.DomEvent.preventDefault),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(t){this._isDrawing=!0,this._startLatLng=t.latlng,L.DomEvent.on(E,"mouseup",this._onMouseUp,this).on(E,"touchend",this._onMouseUp,this).preventDefault(t.originalEvent)},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(e))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showArea:!0,metric:!0},initialize:function(t,e){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},disable:function(){this._enabled&&(this._isCurrentlyTwoClickDrawing=!1,L.Draw.SimpleShape.prototype.disable.call(this))},_onMouseUp:function(t){this._shape||this._isCurrentlyTwoClickDrawing?this._isCurrentlyTwoClickDrawing&&!function w(t,e){for(;(t=t.parentElement)&&!t.classList.contains(e););return t}(t.target,"leaflet-pane")||L.Draw.SimpleShape.prototype._onMouseUp.call(this):this._isCurrentlyTwoClickDrawing=!0},_drawShape:function(t){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,t)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,r=L.Draw.SimpleShape.prototype._getTooltipText.call(this),_=this.options.showArea;return this._shape&&(t=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),e=L.GeometryUtil.geodesicArea(t),i=_?L.GeometryUtil.readableArea(e,this.options.metric):""),{text:r.text,subtext:i}}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(t,e){this.type=L.Draw.Marker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.marker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:this._initialLabelText}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onTouch,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._map.off("click",this._onClick,this).off("click",this._onTouch,this),this._marker&&(this._marker.off("click",this._onClick,this),this._map.removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._mouseMarker.setLatLng(e),this._marker?(e=this._mouseMarker.getLatLng(),this._marker.setLatLng(e)):(this._marker=this._createMarker(e),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_createMarker:function(t){return new L.Marker(t,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset})},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_onTouch:function(t){this._onMouseMove(t),this._onClick()},_fireCreatedEvent:function(){var t=new L.Marker.Touch(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.CircleMarker=L.Draw.Marker.extend({statics:{TYPE:"circlemarker"},options:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,zIndexOffset:2e3},initialize:function(t,e){this.type=L.Draw.CircleMarker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circlemarker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,t,e)},_fireCreatedEvent:function(){var t=new L.CircleMarker(this._marker.getLatLng(),this.options);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)},_createMarker:function(t){return new L.CircleMarker(t,this.options)}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0,feet:!0,nautic:!1},initialize:function(t,e){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){if(L.GeometryUtil.isVersion07x())var e=this._startLatLng.distanceTo(t);else e=this._map.distance(this._startLatLng,t);this._shape?this._shape.setRadius(e):(this._shape=new L.Circle(this._startLatLng,e,this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_onMouseMove:function(t){var e,i=t.latlng,r=this.options.showRadius,u=this.options.metric;if(this._tooltip.updatePosition(i),this._isDrawing){this._drawShape(i),e=this._shape.getRadius().toFixed(1);var _="";r&&(_=L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(e,u,this.options.feet,this.options.nautic)),this._tooltip.updateContent({text:this._endLabelText,subtext:_})}}}),L.Edit=L.Edit||{},L.Edit.Marker=L.Handler.extend({initialize:function(t,e){this._marker=t,L.setOptions(this,e)},addHooks:function(){var t=this._marker;t.dragging.enable(),t.on("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},removeHooks:function(){var t=this._marker;t.dragging.disable(),t.off("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},_onDragEnd:function(t){var e=t.target;e.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:e})},_toggleMarkerHighlight:function(){var t=this._marker._icon;t&&(t.style.display="none",L.DomUtil.hasClass(t,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,-4)):(L.DomUtil.addClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,4)),t.style.display="")},_offsetMarker:function(t,e){var i=parseInt(t.style.marginTop,10)-e,r=parseInt(t.style.marginLeft,10)-e;t.style.marginTop=i+"px",t.style.marginLeft=r+"px"}}),L.Marker.addInitHook(function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({initialize:function(t){this.latlngs=[t._latlngs],t._holes&&(this.latlngs=this.latlngs.concat(t._holes)),this._poly=t,this._poly.on("revert-edited",this._updateLatLngs,this)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._poly._latlngs)?this._poly._latlngs:this._poly._latlngs[0]:this._poly._latlngs},_eachVertexHandler:function(t){for(var e=0;e<this._verticesHandlers.length;e++)t(this._verticesHandlers[e])},addHooks:function(){this._initHandlers(),this._eachVertexHandler(function(t){t.addHooks()})},removeHooks:function(){this._eachVertexHandler(function(t){t.removeHooks()})},updateMarkers:function(){this._eachVertexHandler(function(t){t.updateMarkers()})},_initHandlers:function(){this._verticesHandlers=[];for(var t=0;t<this.latlngs.length;t++)this._verticesHandlers.push(new L.Edit.PolyVerticesEdit(this._poly,this.latlngs[t],this._poly.options.poly))},_updateLatLngs:function(t){this.latlngs=[t.layer._latlngs],t.layer._holes&&(this.latlngs=this.latlngs.concat(t.layer._holes))}}),L.Edit.PolyVerticesEdit=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),drawError:{color:"#b00b00",timeout:1e3}},initialize:function(t,e,i){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this._poly=t,i&&i.drawError&&(i.drawError=L.Util.extend({},this.options.drawError,i.drawError)),this._latlngs=e,L.setOptions(this,i)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]:this._latlngs},addHooks:function(){var t=this._poly,e=t._path;t instanceof L.Polygon||(t.options.fill=!1,t.options.editing&&(t.options.editing.fill=!1)),e&&t.options.editing&&t.options.editing.className&&(t.options.original.className&&t.options.original.className.split(" ").forEach(function(i){L.DomUtil.removeClass(e,i)}),t.options.editing.className.split(" ").forEach(function(i){L.DomUtil.addClass(e,i)})),t.setStyle(t.options.editing),this._poly._map&&(this._map=this._poly._map,this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var t=this._poly,e=t._path;e&&t.options.editing&&t.options.editing.className&&(t.options.editing.className.split(" ").forEach(function(i){L.DomUtil.removeClass(e,i)}),t.options.original.className&&t.options.original.className.split(" ").forEach(function(i){L.DomUtil.addClass(e,i)})),t.setStyle(t.options.original),t._map&&(t._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var t,e,i,r,_,g,u=this._defaultShape();for(t=0,i=u.length;t<i;t++)(r=this._createMarker(u[t],t)).on("click",this._onMarkerClick,this),r.on("contextmenu",this._onContextMenu,this),this._markers.push(r);for(t=0,e=i-1;t<i;e=t++)(0!==t||L.Polygon&&this._poly instanceof L.Polygon)&&(this._createMiddleMarker(_=this._markers[e],g=this._markers[t]),this._updatePrevNext(_,g))},_createMarker:function(t,e){var i=new L.Marker.Touch(t,{draggable:!0,icon:this.options.icon});return i._origLatLng=t,i._index=e,i.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._fireEdit,this).on("touchmove",this._onTouchMove,this).on("touchend",this._fireEdit,this).on("MSPointerMove",this._onTouchMove,this).on("MSPointerUp",this._fireEdit,this),this._markerGroup.addLayer(i),i},_onMarkerDragStart:function(){this._poly.fire("editstart")},_spliceLatLngs:function(){var t=this._defaultShape(),e=[].splice.apply(t,arguments);return this._poly._convertLatLngs(t,!0),this._poly.redraw(),e},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("touchmove",this._onMarkerDrag,this).off("touchend",this._fireEdit,this).off("click",this._onMarkerClick,this).off("MSPointerMove",this._onTouchMove,this).off("MSPointerUp",this._fireEdit,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit"),this._poly._map.fire(L.Draw.Event.EDITVERTEX,{layers:this._markerGroup,poly:this._poly})},_onMarkerDrag:function(t){var e=t.target,i=this._poly,r=L.LatLngUtil.cloneLatLng(e._origLatLng);if(L.extend(e._origLatLng,e._latlng),i.options.poly){var u=i._map._editTooltip;if(!i.options.poly.allowIntersection&&i.intersects()){L.extend(e._origLatLng,r),e.setLatLng(r);var _=i.options.color;i.setStyle({color:this.options.drawError.color}),u&&u.updateContent({text:L.drawLocal.draw.handlers.polyline.error}),setTimeout(function(){i.setStyle({color:_}),u&&u.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext})},1e3)}}e._middleLeft&&e._middleLeft.setLatLng(this._getMiddleLatLng(e._prev,e)),e._middleRight&&e._middleRight.setLatLng(this._getMiddleLatLng(e,e._next)),this._poly._bounds._southWest=L.latLng(1/0,1/0),this._poly._bounds._northEast=L.latLng(-1/0,-1/0);var g=this._poly.getLatLngs();this._poly._convertLatLngs(g,!0),this._poly.redraw(),this._poly.fire("editdrag")},_onMarkerClick:function(t){var e=L.Polygon&&this._poly instanceof L.Polygon?4:3,i=t.target;this._defaultShape().length<e||(this._removeMarker(i),this._updatePrevNext(i._prev,i._next),i._middleLeft&&this._markerGroup.removeLayer(i._middleLeft),i._middleRight&&this._markerGroup.removeLayer(i._middleRight),i._prev&&i._next?this._createMiddleMarker(i._prev,i._next):i._prev?i._next||(i._prev._middleRight=null):i._next._middleLeft=null,this._fireEdit())},_onContextMenu:function(t){this._poly._map.fire(L.Draw.Event.MARKERCONTEXT,{marker:t.target,layers:this._markerGroup,poly:this._poly}),L},_onTouchMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent.touches[0]),i=this._map.layerPointToLatLng(e),r=t.target;L.extend(r._origLatLng,i),r._middleLeft&&r._middleLeft.setLatLng(this._getMiddleLatLng(r._prev,r)),r._middleRight&&r._middleRight.setLatLng(this._getMiddleLatLng(r,r._next)),this._poly.redraw(),this.updateMarkers()},_updateIndexes:function(t,e){this._markerGroup.eachLayer(function(i){i._index>t&&(i._index+=e)})},_createMiddleMarker:function(t,e){var i,r,u,_=this._getMiddleLatLng(t,e),g=this._createMarker(_);g.setOpacity(.6),t._middleRight=e._middleLeft=g,r=function(){g.off("touchmove",r,this);var f=e._index;g._index=f,g.off("click",i,this).on("click",this._onMarkerClick,this),_.lat=g.getLatLng().lat,_.lng=g.getLatLng().lng,this._spliceLatLngs(f,0,_),this._markers.splice(f,0,g),g.setOpacity(1),this._updateIndexes(f,1),e._index++,this._updatePrevNext(t,g),this._updatePrevNext(g,e),this._poly.fire("editstart")},u=function(){g.off("dragstart",r,this),g.off("dragend",u,this),g.off("touchmove",r,this),this._createMiddleMarker(t,g),this._createMiddleMarker(g,e)},g.on("click",i=function(){r.call(this),u.call(this),this._fireEdit()},this).on("dragstart",r,this).on("dragend",u,this).on("touchmove",r,this),this._markerGroup.addLayer(g)},_updatePrevNext:function(t,e){t&&(t._next=e),e&&(e._prev=t)},_getMiddleLatLng:function(t,e){var i=this._poly._map,r=i.project(t.getLatLng()),u=i.project(e.getLatLng());return i.unproject(r._add(u)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))}),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"}),touchMoveIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon"}),touchResizeIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon"})},initialize:function(t,e){L.Browser.touch&&(this.options.moveIcon=this.options.touchMoveIcon,this.options.resizeIcon=this.options.touchResizeIcon),this._shape=t,L.Util.setOptions(this,e)},addHooks:function(){var t=this._shape;this._shape._map&&(this._map=this._shape._map,t.setStyle(t.options.editing),t._map&&(this._map=t._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup)))},removeHooks:function(){var t=this._shape;if(t.setStyle(t.options.original),t._map){this._unbindMarker(this._moveMarker);for(var e=0,i=this._resizeMarkers.length;e<i;e++)this._unbindMarker(this._resizeMarkers[e]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(t,e){var i=new L.Marker.Touch(t,{draggable:!0,icon:e,zIndexOffset:10});return this._bindMarker(i),this._markerGroup.addLayer(i),i},_bindMarker:function(t){t.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this).on("touchstart",this._onTouchStart,this).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onTouchEnd,this).on("MSPointerUp",this._onTouchEnd,this)},_unbindMarker:function(t){t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this).off("touchstart",this._onTouchStart,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onTouchEnd,this).off("MSPointerUp",this._onTouchEnd,this)},_onMarkerDragStart:function(t){t.target.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit")},_onMarkerDrag:function(t){var e=t.target,i=e.getLatLng();e===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw(),this._shape.fire("editdrag")},_onMarkerDragEnd:function(t){t.target.setOpacity(1),this._fireEdit()},_onTouchStart:function(t){if(L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t),"function"==typeof this._getCorners){var e=this._getCorners(),i=t.target,r=i._cornerIndex;i.setOpacity(0),this._oppositeCorner=e[(r+2)%4],this._toggleCornerMarkers(0,r)}this._shape.fire("editstart")},_onTouchMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent.touches[0]),i=this._map.layerPointToLatLng(e);return t.target===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw(),!1},_onTouchEnd:function(t){t.target.setOpacity(1),this.updateMarkers(),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var e=this._shape.getBounds().getCenter();this._moveMarker=this._createMarker(e,this.options.moveIcon)},_createResizeMarker:function(){var t=this._getCorners();this._resizeMarkers=[];for(var e=0,i=t.length;e<i;e++)this._resizeMarkers.push(this._createMarker(t[e],this.options.resizeIcon)),this._resizeMarkers[e]._cornerIndex=e},_onMarkerDragStart:function(t){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t);var e=this._getCorners(),r=t.target._cornerIndex;this._oppositeCorner=e[(r+2)%4],this._toggleCornerMarkers(0,r)},_onMarkerDragEnd:function(t){var i,r=t.target;r===this._moveMarker&&(i=this._shape.getBounds().getCenter(),r.setLatLng(i)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t)},_move:function(t){for(var e,i=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),u=this._shape.getBounds().getCenter(),_=[],g=0,f=i.length;g<f;g++)_.push([t.lat+(e=[i[g].lat-u.lat,i[g].lng-u.lng])[0],t.lng+e[1]]);this._shape.setLatLngs(_),this._repositionCornerMarkers(),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})},_resize:function(t){var e;this._shape.setBounds(L.latLngBounds(t,this._oppositeCorner)),e=this._shape.getBounds(),this._moveMarker.setLatLng(e.getCenter()),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})},_getCorners:function(){var t=this._shape.getBounds();return[t.getNorthWest(),t.getNorthEast(),t.getSouthEast(),t.getSouthWest()]},_toggleCornerMarkers:function(t){for(var e=0,i=this._resizeMarkers.length;e<i;e++)this._resizeMarkers[e].setOpacity(t)},_repositionCornerMarkers:function(){for(var t=this._getCorners(),e=0,i=this._resizeMarkers.length;e<i;e++)this._resizeMarkers[e].setLatLng(t[e])}}),L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.CircleMarker=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getLatLng();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){this._resizeMarkers=[]},_move:function(t){if(this._resizeMarkers.length){var e=this._getResizeMarkerPoint(t);this._resizeMarkers[0].setLatLng(e)}this._shape.setLatLng(t),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})}}),L.CircleMarker.addInitHook(function(){L.Edit.CircleMarker&&(this.editing=new L.Edit.CircleMarker(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})}),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.CircleMarker.extend({_createResizeMarker:function(){var t=this._shape.getLatLng(),e=this._getResizeMarkerPoint(t);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(e,this.options.resizeIcon))},_getResizeMarkerPoint:function(t){var e=this._shape._radius*Math.cos(Math.PI/4),i=this._map.project(t);return this._map.unproject([i.x+e,i.y-e])},_resize:function(t){var e=this._moveMarker.getLatLng();L.GeometryUtil.isVersion07x()?radius=e.distanceTo(t):radius=this._map.distance(e,t),this._shape.setRadius(radius),this._map.editTooltip&&this._map._editTooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.subtext+"<br />"+L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(radius,!0,this.options.feet,this.options.nautic)}),this._shape.setRadius(radius),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})}}),L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable())}),L.Map.mergeOptions({touchExtend:!0}),L.Map.TouchExtend=L.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.on(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.on(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.on(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.on(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.on(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.on(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.on(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.on(this._container,"touchleave",this._onTouchLeave,this))},removeHooks:function(){L.DomEvent.off(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.off(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.off(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.off(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.off(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.off(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.off(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.off(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.off(this._container,"touchleave",this._onTouchLeave,this))},_touchEvent:function(t,e){var i={};if(void 0!==t.touches){if(!t.touches.length)return;i=t.touches[0]}else if("touch"!==t.pointerType||(i=t,!this._filterClick(t)))return;var r=this._map.mouseEventToContainerPoint(i),u=this._map.mouseEventToLayerPoint(i),_=this._map.layerPointToLatLng(u);this._map.fire(e,{latlng:_,layerPoint:u,containerPoint:r,pageX:i.pageX,pageY:i.pageY,originalEvent:t})},_filterClick:function(t){var e=t.timeStamp||t.originalEvent.timeStamp,i=L.DomEvent._lastClick&&e-L.DomEvent._lastClick;return i&&i>100&&i<500||t.target._simulatedClick&&!t._simulated?(L.DomEvent.stop(t),!1):(L.DomEvent._lastClick=e,!0)},_onTouchStart:function(t){this._map._loaded&&this._touchEvent(t,"touchstart")},_onTouchEnd:function(t){this._map._loaded&&this._touchEvent(t,"touchend")},_onTouchCancel:function(t){if(this._map._loaded){var e="touchcancel";this._detectIE()&&(e="pointercancel"),this._touchEvent(t,e)}},_onTouchLeave:function(t){this._map._loaded&&this._touchEvent(t,"touchleave")},_onTouchMove:function(t){this._map._loaded&&this._touchEvent(t,"touchmove")},_detectIE:function(){var t=D.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var i=t.indexOf("rv:");return parseInt(t.substring(i+3,t.indexOf(".",i)),10)}var r=t.indexOf("Edge/");return r>0&&parseInt(t.substring(r+5,t.indexOf(".",r)),10)}}),L.Map.addInitHook("addHandler","touchExtend",L.Map.TouchExtend),L.Marker.Touch=L.Marker.extend({_initInteraction:function(){return this.addInteractiveTarget?L.Marker.prototype._initInteraction.apply(this):this._initInteractionLegacy()},_initInteractionLegacy:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove"];e.concat(this._detectIE?["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"]:["touchcancel"]),L.DomUtil.addClass(t,"leaflet-clickable"),L.DomEvent.on(t,"click",this._onMouseClick,this),L.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)L.DomEvent.on(t,e[i],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_detectIE:function(){var t=D.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var i=t.indexOf("rv:");return parseInt(t.substring(i+3,t.indexOf(".",i)),10)}var r=t.indexOf("Edge/");return r>0&&parseInt(t.substring(r+5,t.indexOf(".",r)),10)}}),L.LatLngUtil={cloneLatLngs:function(t){for(var e=[],i=0,r=t.length;i<r;i++)Array.isArray(t[i])?e.push(L.LatLngUtil.cloneLatLngs(t[i])):e.push(this.cloneLatLng(t[i]));return e},cloneLatLng:function(t){return L.latLng(t.lat,t.lng)}},t={km:2,ha:2,m:0,mi:2,ac:2,yd:0,ft:0,nm:2},L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(e){var i,r,u=e.length,_=0,g=Math.PI/180;if(u>2){for(var f=0;f<u;f++)_+=((r=e[(f+1)%u]).lng-(i=e[f]).lng)*g*(2+Math.sin(i.lat*g)+Math.sin(r.lat*g));_=6378137*_*6378137/2}return Math.abs(_)},formattedNumber:function(e,i){var r=parseFloat(e).toFixed(i),u=L.drawLocal.format&&L.drawLocal.format.numeric,_=u&&u.delimiters,g=_&&_.thousands,f=_&&_.decimal;if(g||f){var y=r.split(".");r=g?y[0].replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+g):y[0],f=f||".",y.length>1&&(r=r+f+y[1])}return r},readableArea:function(e,i,g){var u,_;return g=L.Util.extend({},t,g),i?(_=["ha","m"],type=typeof i,"string"===type?_=[i]:"boolean"!==type&&(_=i),u=e>=1e6&&-1!==_.indexOf("km")?L.GeometryUtil.formattedNumber(1e-6*e,g.km)+" km\xb2":e>=1e4&&-1!==_.indexOf("ha")?L.GeometryUtil.formattedNumber(1e-4*e,g.ha)+" ha":L.GeometryUtil.formattedNumber(e,g.m)+" m\xb2"):u=(e/=.836127)>=3097600?L.GeometryUtil.formattedNumber(e/3097600,g.mi)+" mi\xb2":e>=4840?L.GeometryUtil.formattedNumber(e/4840,g.ac)+" acres":L.GeometryUtil.formattedNumber(e,g.yd)+" yd\xb2",u},readableDistance:function(e,i,r,u,f){var g;switch(f=L.Util.extend({},t,f),i?"string"==typeof i?i:"metric":r?"feet":u?"nauticalMile":"yards"){case"metric":g=e>1e3?L.GeometryUtil.formattedNumber(e/1e3,f.km)+" km":L.GeometryUtil.formattedNumber(e,f.m)+" m";break;case"feet":e*=3.28083,g=L.GeometryUtil.formattedNumber(e,f.ft)+" ft";break;case"nauticalMile":e*=.53996,g=L.GeometryUtil.formattedNumber(e/1e3,f.nm)+" nm";break;default:g=(e*=1.09361)>1760?L.GeometryUtil.formattedNumber(e/1760,f.mi)+" miles":L.GeometryUtil.formattedNumber(e,f.yd)+" yd"}return g},isVersion07x:function(){var e=L.version.split(".");return 0===parseInt(e[0],10)&&7===parseInt(e[1],10)}}),L.Util.extend(L.LineUtil,{segmentsIntersect:function(t,e,i,r){return this._checkCounterclockwise(t,i,r)!==this._checkCounterclockwise(e,i,r)&&this._checkCounterclockwise(t,e,i)!==this._checkCounterclockwise(t,e,r)},_checkCounterclockwise:function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}}),L.Polyline.include({intersects:function(){var t,r=this._getProjectedPoints(),u=r?r.length:0;if(this._tooFewPointsForIntersection())return!1;for(t=u-1;t>=3;t--)if(this._lineSegmentsIntersectsRange(r[t-1],r[t],t-2))return!0;return!1},newLatLngIntersects:function(t,e){return!!this._map&&this.newPointIntersects(this._map.latLngToLayerPoint(t),e)},newPointIntersects:function(t,e){var i=this._getProjectedPoints(),r=i?i.length:0,u=i?i[r-1]:null,_=r-2;return!this._tooFewPointsForIntersection(1)&&this._lineSegmentsIntersectsRange(u,t,_,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._getProjectedPoints(),i=e?e.length:0;return!e||(i+=t||0)<=3},_lineSegmentsIntersectsRange:function(t,e,i,r){var g=this._getProjectedPoints();r=r||0;for(var f=i;f>r;f--)if(L.LineUtil.segmentsIntersect(t,e,g[f-1],g[f]))return!0;return!1},_getProjectedPoints:function(){if(!this._defaultShape)return this._originalPoints;for(var t=[],e=this._defaultShape(),i=0;i<e.length;i++)t.push(this._map.latLngToLayerPoint(e[i]));return t}}),L.Polygon.include({intersects:function(){var t,u=this._getProjectedPoints();return!this._tooFewPointsForIntersection()&&(!!L.Polyline.prototype.intersects.call(this)||this._lineSegmentsIntersectsRange(u[(t=u.length)-1],u[0],t-2,1))}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(t){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");var e;L.Control.prototype.initialize.call(this,t),this._toolbars={},L.DrawToolbar&&this.options.draw&&(e=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=e,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(e=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=e,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.toolbar=this},onAdd:function(t){var e,i=L.DomUtil.create("div","leaflet-draw"),r=!1;for(var u in this._toolbars)this._toolbars.hasOwnProperty(u)&&(e=this._toolbars[u].addToolbar(t))&&(r||(L.DomUtil.hasClass(e,"leaflet-draw-toolbar-top")||L.DomUtil.addClass(e.childNodes[0],"leaflet-draw-toolbar-top"),r=!0),i.appendChild(e));return i},onRemove:function(){for(var t in this._toolbars)this._toolbars.hasOwnProperty(t)&&this._toolbars[t].removeToolbar()},setDrawingOptions:function(t){for(var e in this._toolbars)this._toolbars[e]instanceof L.DrawToolbar&&this._toolbars[e].setOptions(t)},_toolbarEnabled:function(t){var e=t.target;for(var i in this._toolbars)this._toolbars[i]!==e&&this._toolbars[i].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))}),L.Toolbar=L.Class.extend({initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null;var e=L.version.split(".");1===parseInt(e[0],10)&&parseInt(e[1],10)>=2?L.Toolbar.include(L.Evented.prototype):L.Toolbar.include(L.Mixin.Events)},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(t){var e,i=L.DomUtil.create("div","leaflet-draw-section"),r=0,u=this._toolbarClass||"",_=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=t,e=0;e<_.length;e++)_[e].enabled&&this._initModeHandler(_[e].handler,this._toolbarContainer,r++,u,_[e].title);if(r)return this._lastButtonIndex=--r,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),i.appendChild(this._toolbarContainer),i.appendChild(this._actionsContainer),i},removeToolbar:function(){for(var t in this._modes)this._modes.hasOwnProperty(t)&&(this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),this._modes[t].handler.disable(),this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var e=0,i=this._actionButtons.length;e<i;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,i,r,u){var _=t.type;this._modes[_]={},this._modes[_].handler=t,this._modes[_].button=this._createButton({type:_,title:u,className:r+"-"+_,container:e,callback:this._modes[_].handler.enable,context:this._modes[_].handler}),this._modes[_].buttonIndex=i,this._modes[_].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_detectIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!D.MSStream},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container),i=L.DomUtil.create("span","sr-only",t.container);e.href="#",e.appendChild(i),t.title&&(e.title=t.title,i.innerHTML=t.title),t.text&&(e.innerHTML=t.text,i.innerHTML=t.text);var r=this._detectIOS()?"touchstart":"click";return L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"touchstart",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,r,t.callback,t.context),e},_disposeButton:function(t,e){var i=this._detectIOS()?"touchstart":"click";L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"touchstart",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,i,e)},_handlerActivated:function(t){this.disable(),this._activeMode=this._modes[t.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){var e,i,r,u,_=this._actionsContainer,g=this.getActions(t),f=g.length;for(i=0,r=this._actionButtons.length;i<r;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback);for(this._actionButtons=[];_.firstChild;)_.removeChild(_.firstChild);for(var y=0;y<f;y++)"enabled"in g[y]&&!g[y].enabled||(e=L.DomUtil.create("li","",_),u=this._createButton({title:g[y].title,text:g[y].text,container:e,callback:g[y].callback,context:g[y].context}),this._actionButtons.push({button:u,callback:g[y].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,i=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=i+"px",0===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block",this._map.fire(L.Draw.Event.TOOLBAROPENED)},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom"),this._map.fire(L.Draw.Event.TOOLBARCLOSED)}}),L.Draw=L.Draw||{},L.Draw.Tooltip=L.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._visible=!1,this._container=t.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",t.text||t.subtext?(this._visible=!0,this._container.style.visibility="inherit"):(this._visible=!1,this._container.style.visibility="hidden"),this):this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),i=this._container;return this._container&&(this._visible&&(i.style.visibility="inherit"),L.DomUtil.setPosition(i,e)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}}),L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{},circlemarker:{}},initialize:function(t){for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,t)},getModeHandlers:function(t){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(t,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(t,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(t,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(t,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(t,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.circlemarker,handler:new L.Draw.CircleMarker(t,this.options.circlemarker),title:L.drawLocal.draw.toolbar.buttons.circlemarker}]},getActions:function(t){return[{enabled:t.completeShape,title:L.drawLocal.draw.toolbar.finish.title,text:L.drawLocal.draw.toolbar.finish.text,callback:t.completeShape,context:t},{enabled:t.deleteLastVertex,title:L.drawLocal.draw.toolbar.undo.title,text:L.drawLocal.draw.toolbar.undo.text,callback:t.deleteLastVertex,context:t},{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(t){for(var e in L.setOptions(this,t),this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])}}),L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1}},remove:{},poly:null,featureGroup:null},initialize:function(t){t.edit&&(void 0===t.edit.selectedPathOptions&&(t.edit.selectedPathOptions=this.options.edit.selectedPathOptions),t.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,t.edit.selectedPathOptions)),t.remove&&(t.remove=L.extend({},this.options.remove,t.remove)),t.poly&&(t.poly=L.extend({},this.options.poly,t.poly)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,t),this._selectedFeatureCount=0},getModeHandlers:function(t){var e=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(t,{featureGroup:e,selectedPathOptions:this.options.edit.selectedPathOptions,poly:this.options.poly}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(t,{featureGroup:e}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(t){var e=[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}];return t.removeAllLayers&&e.push({title:L.drawLocal.edit.toolbar.actions.clearAll.title,text:L.drawLocal.edit.toolbar.actions.clearAll.text,callback:this._clearAllLayers,context:this}),e},addToolbar:function(t){var e=L.Toolbar.prototype.addToolbar.call(this,t);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),e},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode&&this._activeMode.handler.disable()},_clearAllLayers:function(){this._activeMode.handler.removeAllLayers(),this._activeMode&&this._activeMode.handler.disable()},_checkDisabled:function(){var t,i=0!==this.options.featureGroup.getLayers().length;this.options.edit&&(t=this._modes[L.EditToolbar.Edit.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(t=this._modes[L.EditToolbar.Delete.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.setOptions(this,e),this._featureGroup=e.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE;var i=L.version.split(".");1===parseInt(i[0],10)&&parseInt(i[1],10)>=2?L.EditToolbar.Edit.include(L.Evented.prototype):L.EditToolbar.Edit.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.EDITSTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.EDITSTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),t._editTooltip=this._tooltip,this._updateTooltip(),this._map.on("mousemove",this._onMouseMove,this).on("touchmove",this._onMouseMove,this).on("MSPointerMove",this._onMouseMove,this).on(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this).off("touchmove",this._onMouseMove,this).off("MSPointerMove",this._onMouseMove,this).off(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},revertLayers:function(){this._featureGroup.eachLayer(function(t){this._revertLayer(t)},this)},save:function(){var t=new L.LayerGroup;this._featureGroup.eachLayer(function(e){e.edited&&(t.addLayer(e),e.edited=!1)}),this._map.fire(L.Draw.Event.EDITED,{layers:t})},_backupLayer:function(t){var e=L.Util.stamp(t);this._uneditedLayerProps[e]||(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?this._uneditedLayerProps[e]={latlngs:L.LatLngUtil.cloneLatLngs(t.getLatLngs())}:t instanceof L.Circle?this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng()),radius:t.getRadius()}:(t instanceof L.Marker||t instanceof L.CircleMarker)&&(this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng())}))},_getTooltipText:function(){return{text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}},_updateTooltip:function(){this._tooltip.updateContent(this._getTooltipText())},_revertLayer:function(t){var e=L.Util.stamp(t);t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?t.setLatLngs(this._uneditedLayerProps[e].latlngs):t instanceof L.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):(t instanceof L.Marker||t instanceof L.CircleMarker)&&t.setLatLng(this._uneditedLayerProps[e].latlng),t.fire("revert-edited",{layer:t}))},_enableLayerEdit:function(t){var e,i,r=t.layer||t.target||t;this._backupLayer(r),this.options.poly&&(i=L.Util.extend({},this.options.poly),r.options.poly=i),this.options.selectedPathOptions&&((e=L.Util.extend({},this.options.selectedPathOptions)).maintainColor&&(e.color=r.options.color,e.fillColor=r.options.fillColor),r.options.original=L.extend({},r.options),r.options.editing=e),r instanceof L.Marker?(r.editing&&r.editing.enable(),r.dragging.enable(),r.on("dragend",this._onMarkerDragEnd).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onMarkerDragEnd,this).on("MSPointerUp",this._onMarkerDragEnd,this)):r.editing.enable()},_disableLayerEdit:function(t){var e=t.layer||t.target||t;e.edited=!1,e.editing&&e.editing.disable(),delete e.options.editing,delete e.options.original,this._selectedPathOptions&&(e instanceof L.Marker?this._toggleMarkerHighlight(e):(e.setStyle(e.options.previousOptions),delete e.options.previousOptions)),e instanceof L.Marker?(e.dragging.disable(),e.off("dragend",this._onMarkerDragEnd,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onMarkerDragEnd,this).off("MSPointerUp",this._onMarkerDragEnd,this)):e.editing.disable()},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_onMarkerDragEnd:function(t){var e=t.target;e.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:e})},_onTouchMove:function(t){var i=this._map.mouseEventToLayerPoint(t.originalEvent.changedTouches[0]),r=this._map.layerPointToLatLng(i);t.target.setLatLng(r)},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE;var i=L.version.split(".");1===parseInt(i[0],10)&&parseInt(i[1],10)>=2?L.EditToolbar.Delete.include(L.Evented.prototype):L.EditToolbar.Delete.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DELETESTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DELETESTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._deletedLayers.eachLayer(function(t){this._deletableLayers.addLayer(t),t.fire("revert-deleted",{layer:t})},this)},save:function(){this._map.fire(L.Draw.Event.DELETED,{layers:this._deletedLayers})},removeAllLayers:function(){this._deletableLayers.eachLayer(function(t){this._removeLayer({layer:t})},this),this.save()},_enableLayerDelete:function(t){(t.layer||t.target||t).on("click",this._removeLayer,this)},_disableLayerDelete:function(t){var e=t.layer||t.target||t;e.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(e)},_removeLayer:function(t){var e=t.layer||t.target||t;this._deletableLayers.removeLayer(e),this._deletedLayers.addLayer(e),e.fire("deleted")},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return 0!==this._deletableLayers.getLayers().length}})}}]);