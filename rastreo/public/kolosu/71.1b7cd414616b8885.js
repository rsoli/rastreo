"use strict";(self.webpackChunkkolosu=self.webpackChunkkolosu||[]).push([[71],{71:(C,d,r)=>{r.r(d),r.d(d,{UsuarioModule:()=>M});var p=r(6895),l=r(7046),c=r(805),u=r(740),s=r(1571),h=r(6253),f=r(3617),g=r(2453),v=r(1023),_=r(4594);let b=(()=>{class i{constructor(a,e,o){this.messageService=a,this.apiService=e,this.router=o,this.loading=!1,this.lista_usuarios=[],this.columnas_usuario=u.I.columns,this.columnas_contrasena=u.I.columns_password,this.es_admin=!1,this.toolbarButtons=new Array,this.modal_contrasena=!1,this.lista_usuarios_seleccionado={}}ngOnInit(){this.ListarUsuarios(),u.I.initialize(this.apiService),this.verSession(),this.AgregarBotones()}AgregarBotones(){this.toolbarButtons.push({name:"btnModalPass",label:"Contrase\xf1a",tooltip:"Cambiar contrase\xf1a",action:"onModalPass",icon:"pi pi-user-edit",disabled:!0,class:"p-button-rounded p-button-info"})}ButtonClick(a){const{action:e}=a;"onModalPass"===e&&(console.log("Editar contrase\xf1a"),this.modal_contrasena=!0)}seleccionarUsuario(a){this.messageService.clear(),this.MensajeInfo(a.persona,!0),this.ButtonEnabled("btnModalPass",!1),this.lista_usuarios_seleccionado=a,console.log(this.lista_usuarios_seleccionado)}deshacerSeleccionUsuario(a){this.ButtonEnabled("btnModalPass",!0)}verSession(){this.es_admin=1!=JSON.parse(localStorage.getItem("accesos")||"{}").sesion}ListarUsuarios(){this.loading=!0,this.apiService.getAll("auth/lista_usuarios").subscribe({next:a=>{this.lista_usuarios=JSON.parse(JSON.stringify(a)).lista_usuarios},error:a=>{console.log(a)},complete:()=>{this.loading=!1}})}guardarUsuario(a){this.loading=!0,a.id_persona=JSON.parse(JSON.stringify(a)).id_persona.value;let e=JSON.parse(JSON.stringify(a)).id_roles;a.id_roles=e.map(o=>({id_rol:o.value})),this.apiService.create("auth/post_usuario",a).subscribe({next:o=>{var t;const m=null===(t=o?.mensaje)||void 0===t?void 0:t[0];m?this.MensajeError(m):this.ListarUsuarios()},error:o=>{this.MensajeError("Verifique su conexi\xf3n a internet"),console.log(o)},complete:()=>{this.loading=!1}})}eliminarUsuario(a){a.id_usuario&&(this.loading=!0,this.apiService.delete("auth/eliminar_usuario",a.id_usuario).subscribe({next:()=>{this.ListarUsuarios()},error:e=>{console.log("Error al eliminar:",e),this.MensajeError("Error al eliminar")},complete:()=>{this.loading=!1}}))}guardarModal(a){console.log("llego modal ",a),a.contrasena==a.repetir_contrasena?(this.cerrarModal(),this.cambiarContrasena(a),this.lista_usuarios_seleccionado=[]):this.MensajeError("Las contrase\xf1as no coinciden")}cambiarContrasena(a){this.loading=!0,this.apiService.create("auth/post_cambio_contrasena",a).subscribe({next:()=>{this.ListarUsuarios()},error:e=>{console.log("Error al eliminar:",e),this.MensajeError("Error al eliminar")},complete:()=>{this.loading=!1}})}cerrarModal(){this.modal_contrasena=!1}MensajeError(a){this.messageService.add({severity:"error",summary:"Error",detail:a})}MensajeSucces(a){this.messageService.add({severity:"success",summary:"Exito",detail:a})}MensajeInfo(a,e){this.messageService.add(1==e?{severity:"info",summary:"Seleccionado",detail:a}:{severity:"info",summary:"Informaci\xf3n",detail:a})}MensajeAdvertencia(a){this.messageService.add({severity:"error",summary:"Error",detail:a})}ButtonEnabled(a,e){this.toolbarButtons.forEach(o=>{o.name===a&&(o.disabled=e)})}}return i.\u0275fac=function(a){return new(a||i)(s.Y36(c.ez),s.Y36(h.s),s.Y36(l.F0))},i.\u0275cmp=s.Xpm({type:i,selectors:[["app-usuario"]],features:[s._Bn([c.ez])],decls:5,vars:10,consts:[[1,"card"],[3,"loading"],["titleTable","Lista usuario",3,"buttonNew","buttonEdit","buttonDelete","buttons","columns","data","buttonClick","selected","Unselect","formSave","delete"],["titleModal","Cambio de contrase\xf1a",3,"columns","modalVisible","formData","formSave","closeModal"]],template:function(a,e){1&a&&(s.TgZ(0,"div",0),s._UZ(1,"p-toast")(2,"app-loading",1),s.TgZ(3,"app-tabla-dinamica",2),s.NdJ("buttonClick",function(t){return e.ButtonClick(t)})("selected",function(t){return e.seleccionarUsuario(t)})("Unselect",function(t){return e.deshacerSeleccionUsuario(t)})("formSave",function(t){return e.guardarUsuario(t)})("delete",function(t){return e.eliminarUsuario(t)}),s.qZA(),s.TgZ(4,"app-modal-dinamica",3),s.NdJ("formSave",function(t){return e.guardarModal(t)})("closeModal",function(){return e.cerrarModal()}),s.qZA()()),2&a&&(s.xp6(2),s.Q6J("loading",e.loading),s.xp6(1),s.Q6J("buttonNew",e.es_admin)("buttonEdit",e.es_admin)("buttonDelete",e.es_admin)("buttons",e.toolbarButtons)("columns",e.columnas_usuario)("data",e.lista_usuarios),s.xp6(1),s.Q6J("columns",e.columnas_contrasena)("modalVisible",e.modal_contrasena)("formData",e.lista_usuarios_seleccionado))},dependencies:[f.N,g.FN,v.C,_.b]}),i})(),S=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=s.oAB({type:i}),i.\u0275inj=s.cJS({imports:[l.Bz.forChild([{path:"",component:b}]),l.Bz]}),i})();var U=r(1511);let M=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=s.oAB({type:i}),i.\u0275inj=s.cJS({imports:[p.ez,S,U.m]}),i})()}}]);